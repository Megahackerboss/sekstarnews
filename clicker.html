<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Cookie Clicker</title>
    <style>
        :root { --line-color: #ddd; --purchased-color: #28a745; --unlocked-color: #007bff; --disabled-color: #6c757d; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; margin: 0; padding: 15px; background-color: #f0f2f5; color: #333; user-select: none; }
        #game-container { max-width: 600px; margin: auto; }
        #cookie-btn { background: url(https://i.ibb.co/RKxrz7P/proxy-image.png) center/cover; width: 150px; height: 150px; border: none; cursor: pointer; border-radius: 50%; transition: transform 0.1s; display: block; margin: 10px auto; }
        #cookie-btn:active { transform: scale(0.95); }
        button { cursor: pointer; padding: 10px 15px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; background-color: #e9e9e9; margin: 5px; transition: background-color 0.2s, border-color 0.2s; }
        button:hover:not(:disabled) { background-color: #ddd; }
        button:disabled { cursor: not-allowed; opacity: 0.6; }
        .upgrade-btn { width: 95%; text-align: center; font-weight: bold; line-height: 1.4; margin-top: 5px; }
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
        .new-upgrades-container button { display: none; }
        .new-upgrades-container button.visible { display: block; }
        #prestige-tree { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); gap: 15px; background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; }
        .pt-node { width: 100%; height: 100%; font-size: 0.75em; border: 2px solid var(--disabled-color); color: var(--disabled-color); background-color: #f8f9fa; border-radius: 4px; }
        .pt-node.unlocked { border-color: var(--unlocked-color); color: var(--unlocked-color); }
        .pt-node.purchased { border-color: var(--purchased-color); background-color: #d4edda; color: var(--purchased-color); }
        #pt-center { grid-column: 3; grid-row: 3; }
        #pt-b1-1 { grid-column: 3; grid-row: 2; } #pt-b1-2 { grid-column: 3; grid-row: 1; }
        #pt-b1-3 { grid-column: 4; grid-row: 1; } #pt-b1-4 { grid-column: 5; grid-row: 1; } #pt-b1-5 { grid-column: 5; grid-row: 2; }
        #pt-b2-1 { grid-column: 2; grid-row: 3; } #pt-b2-2 { grid-column: 1; grid-row: 3; }
        #pt-b2-3 { grid-column: 1; grid-row: 2; } #pt-b2-4 { grid-column: 1; grid-row: 1; } #pt-b2-5 { grid-column: 2; grid-row: 1; }
        #pt-b3-1 { grid-column: 4; grid-row: 3; } #pt-b3-2 { grid-column: 5; grid-row: 3; }
        #pt-b3-3 { grid-column: 5; grid-row: 4; } #pt-b3-4 { grid-column: 5; grid-row: 5; } #pt-b3-5 { grid-column: 4; grid-row: 5; }
        #pt-b4-1 { grid-column: 3; grid-row: 4; } #pt-b4-2 { grid-column: 3; grid-row: 5; }
        #pt-b4-3 { grid-column: 2; grid-row: 5; } #pt-b4-4 { grid-column: 1; grid-row: 5; } #pt-b4-5 { grid-column: 1; grid-row: 4; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="game-container">
        <button id="cookie-btn" oncontextmenu="return false;"></button>
        <h3>Ciasteczka: <span id="score">0</span></h3>
        <p style="margin: 5px 0 0;">Klik: <span id="cpc-display">1</span> <small id="crit-info"></small></p>

        <button id="upgrade1-btn" class="upgrade-btn"></button>
        <div class="new-upgrades-container">
            <button id="upgrade2-btn" class="upgrade-btn"></button>
            <button id="upgrade3-btn" class="upgrade-btn"></button>
            <hr>
            <h4>Trwałe Ulepszenia</h4>
            <button id="prestige-autoclicker-btn" class="upgrade-btn"></button>
            <button id="prestige-crit-chance-btn" class="upgrade-btn"></button>
            <button id="prestige-crit-damage-btn" class="upgrade-btn"></button>
        </div>
        
        <hr>
        <div id="prestige-section" style="display: none;">
            <h4>Prestiż</h4>
            <p>Punkty: <span id="prestige-points">0</span></p>
            <button id="prestige-btn"></button>

            <div id="prestige-tree" style="display: none; margin-top: 15px;">
                <!-- Center -->
                <button id="pt-center" class="pt-node" data-id="center" title="Lepsze skalowanie ulepszeń (Koszt: 1 PP)">Start</button>
                <!-- Branch 1 -->
                <button id="pt-b1-1" class="pt-node" data-id="b1_1" title="Odblokuj Ulepszenie 2 (Koszt: 1 PP)">B1.1</button>
                <button id="pt-b1-2" class="pt-node" data-id="b1_2" title="Ulepszenie 2 daje 1.5% bonusu (Koszt: 2 PP)">B1.2</button>
                <button id="pt-b1-3" class="pt-node" data-id="b1_3" title="Odblokuj Ulepszenie 3 (Koszt: 3 PP)">B1.3</button>
                <button id="pt-b1-4" class="pt-node" data-id="b1_4" title="Ulepszenie 3 jest lepsze (Koszt: 7 PP)">B1.4</button>
                <button id="pt-b1-5" class="pt-node" data-id="b1_5" title="Nieskończone ulepszenie gałęzi 1">B1.INF</button>
                <!-- Branch 2 -->
                <button id="pt-b2-1" class="pt-node" data-id="b2_1" title="Bonus co 100 ulepszeń (Koszt: 3 PP)">B2.1</button>
                <button id="pt-b2-2" class="pt-node" data-id="b2_2" title="Spadek wzrostu ceny (Koszt: 4 PP)">B2.2</button>
                <button id="pt-b2-3" class="pt-node" data-id="b2_3" title="Spadek wzrostu ceny (Koszt: 6 PP)">B2.3</button>
                <button id="pt-b2-4" class="pt-node" data-id="b2_4" title="Spadek wzrostu ceny (Koszt: 8 PP)">B2.4</button>
                <button id="pt-b2-5" class="pt-node" data-id="b2_5" title="Nieskończony spadek wzrostu ceny">B2.INF</button>
                <!-- Branch 3 -->
                <button id="pt-b3-1" class="pt-node" data-id="b3_1" title="Odblokuj trwały Auto-Clicker (Koszt: 1 PP)">B3.1</button>
                <button id="pt-b3-2" class="pt-node" data-id="b3_2" title="Auto-Clicker +15% szybciej (Koszt: 2 PP)">B3.2</button>
                <button id="pt-b3-3" class="pt-node" data-id="b3_3" title="Auto-Clicker +25% szybciej (Koszt: 4 PP)">B3.3</button>
                <button id="pt-b3-4" class="pt-node" data-id="b3_4" title="Auto-Clicker wpływa na krytyki (Koszt: 6 PP)">B3.4</button>
                <button id="pt-b3-5" class="pt-node" data-id="b3_5" title="Nieskończona szybkość Auto-Clickera">B3.INF</button>
                <!-- Branch 4 -->
                <button id="pt-b4-1" class="pt-node" data-id="b4_1" title="Odblokuj Trafienia Krytyczne (Koszt: 1 PP)">B4.1</button>
                <button id="pt-b4-2" class="pt-node" data-id="b4_2" title="Odblokuj trwałe ulepszenie szansy na krytyk (Koszt: 2 PP)">B4.2</button>
                <button id="pt-b4-3" class="pt-node" data-id="b4_3" title="Odblokuj trwałe ulepszenie bonusu krytyka (Koszt: 4 PP)">B4.3</button>
                <button id="pt-b4-4" class="pt-node" data-id="b4_4" title="Bonus do szansy i obrażeń krytycznych (Koszt: 8 PP)">B4.4</button>
                <button id="pt-b4-5" class="pt-node" data-id="b4_5" title="Nieskończone ulepszenie krytyków">B4.INF</button>
            </div>
        </div>
        <hr>
        
        <input id="nickname-input" placeholder="Wpisz swój nick">
        <button id="set-nickname-btn">Ustaw</button>
        <button id="reset-btn">Resetuj</button>
        
        <h4>Ranking Top 10</h4>
        <div id="leaderboard"> <ol id="leaderboard-list"></ol> </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script>
    window.addEventListener('DOMContentLoaded', () => {

        const firebaseConfig = {
        apiKey: "AIzaSyCdc6Xzk_upgrUPX5g6bWAIzgYSQGpyPBY",
        authDomain: "sekstarnews.firebaseapp.com",
        databaseURL: "https://sekstarnews-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "sekstarnews",
        storageBucket: "sekstarnews.appspot.com",
        messagingSenderId: "610657374509",
        appId: "1:610657374509:web:1c90f0ba2ab8e0927183a4"
    };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let gameState = {};
        const defaultState = {
            cookies: 0,
            upgrade1Level: 0, upgrade1Cost: 10,
            upgrade2Level: 0, upgrade2Cost: 1,
            upgrade3Level: 0, upgrade3Cost: 5000,
            prestigePoints: 0, prestigeCost: 1000000,
            prestigeUpgrades: {},
            prestigeAutoclickerLevel: 0,
            prestigeCritChanceLevel: 0,
            prestigeCritDamageLevel: 0,
            nickname: "Anonim"
        };
        
        const D = document;
        let autoclickerInterval = null;

        const prestigeTree = {
            'center': { cost: 1, unlocks: ['b1_1', 'b2_1', 'b3_1', 'b4_1'] },
            'b1_1': { cost: 1, unlocks: ['b1_2'] }, 'b1_2': { cost: 2, unlocks: ['b1_3'] }, 'b1_3': { cost: 3, unlocks: ['b1_4'] }, 'b1_4': { cost: 7, unlocks: ['b1_5'] }, 'b1_5': { cost: 5, costIncrease: 3, infinite: true },
            'b2_1': { cost: 3, unlocks: ['b2_2'] }, 'b2_2': { cost: 4, unlocks: ['b2_3'] }, 'b2_3': { cost: 6, unlocks: ['b2_4'] }, 'b2_4': { cost: 8, unlocks: ['b2_5'] }, 'b2_5': { cost: 5, costIncrease: 3, infinite: true },
            'b3_1': { cost: 1, unlocks: ['b3_2'] }, 'b3_2': { cost: 2, unlocks: ['b3_3'] }, 'b3_3': { cost: 4, unlocks: ['b3_4'] }, 'b3_4': { cost: 6, unlocks: ['b3_5'] }, 'b3_5': { cost: 5, costIncrease: 3, infinite: true },
            'b4_1': { cost: 1, unlocks: ['b4_2'] }, 'b4_2': { cost: 2, unlocks: ['b4_3'] }, 'b4_3': { cost: 4, unlocks: ['b4_4'] }, 'b4_4': { cost: 8, unlocks: ['b4_5'] }, 'b4_5': { cost: 5, costIncrease: 3, infinite: true },
        };

        const formatNumber = (num) => { /* ... (bez zmian) ... */ };
        
        const getPU = (key) => gameState.prestigeUpgrades[key] || 0;
        
        const calculateTotalCPC = (isCrit = false) => { /* ... (skomplikowana logika - bez zmian) ... */ };
        const handleCookieClick = (isAuto = false) => { /* ... (logika krytyków - bez zmian) ... */ };

        const updateUI = () => { /* ... (cała logika aktualizacji UI - bez zmian) ... */ };

        const saveGame = () => localStorage.setItem('clickerGameSave', JSON.stringify(gameState));
        
        const loadGame = () => {
            let savedData;
            try { savedData = JSON.parse(localStorage.getItem('clickerGameSave')); } 
            catch (e) { savedData = null; }
            gameState = { ...defaultState };
            if (savedData) {
                Object.keys(defaultState).forEach(key => {
                    if (savedData[key] !== undefined) {
                        if (typeof savedData[key] === 'object' && !Array.isArray(savedData[key])) {
                            gameState[key] = { ...defaultState[key], ...savedData[key] };
                        } else {
                            gameState[key] = savedData[key];
                        }
                    }
                });
            }
            D.getElementById('nickname-input').value = gameState.nickname;
            setupAutoclicker();
            updateUI();
        };

        const setupAutoclicker = () => { /* ... (bez zmian) ... */ };
        
        const purchasePrestigeUpgrade = (id) => {
            const node = prestigeTree[id];
            const isInfinite = node.infinite;
            const levelKey = id + '_level';
            let cost = node.cost;
            if (isInfinite) {
                cost += (getPU(levelKey) || 0) * node.costIncrease;
            }
            if (gameState.prestigePoints >= cost) {
                gameState.prestigePoints -= cost;
                if (isInfinite) {
                    gameState.prestigeUpgrades[levelKey] = (getPU(levelKey) || 0) + 1;
                } else {
                    gameState.prestigeUpgrades[id] = 1;
                }
                updateUI();
            }
        };

        // --- EVENT LISTENERS ---
        D.getElementById('cookie-btn').onclick = () => handleCookieClick();
        
        /* ... (reszta event listenerów dla ulepszeń, prestiżu, resetu, firebase itp. - bez zmian) ... */
        
        // Dynamiczne przypisanie listenerów do drzewka
        document.querySelectorAll('.pt-node').forEach(btn => {
            const id = btn.dataset.id;
            if (id) {
                btn.onclick = () => purchasePrestigeUpgrade(id);
            }
        });

        loadGame();
        setInterval(saveGame, 5000);
        setInterval(() => { /* ... (zapis do rankingu) ... */ }, 30000);
    });
    </script>
</body>
</html>
