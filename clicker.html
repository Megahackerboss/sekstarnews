<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Cookie Clicker</title>
    <style>
        :root { --line-color: #ddd; --purchased-color: #28a745; --unlocked-color: #007bff; --disabled-color: #6c757d; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; margin: 0; padding: 15px; background-color: #f0f2f5; color: #333; user-select: none; }
        #game-container { max-width: 600px; margin: auto; }
        #cookie-btn { background: url(https://i.ibb.co/RKxrz7P/proxy-image.png) center/cover; width: 150px; height: 150px; border: none; cursor: pointer; border-radius: 50%; transition: transform 0.1s; display: block; margin: 10px auto; }
        #cookie-btn:active { transform: scale(0.95); }
        button { cursor: pointer; padding: 10px 15px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; background-color: #e9e9e9; margin: 5px; transition: background-color 0.2s, border-color 0.2s; }
        button:hover:not(:disabled) { background-color: #ddd; }
        button:disabled { cursor: not-allowed; opacity: 0.6; }
        .upgrade-btn { width: 95%; text-align: center; font-weight: bold; line-height: 1.4; margin-top: 5px; }
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
        .new-upgrades-container button { display: none; }
        .new-upgrades-container button.visible { display: block; }
        #prestige-tree { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); gap: 15px; background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; }
        .pt-node { width: 100%; height: 100%; font-size: 0.75em; border: 2px solid var(--disabled-color); color: var(--disabled-color); background-color: #f8f9fa; border-radius: 4px; padding: 5px; box-sizing: border-box; }
        .pt-node.unlocked { border-color: var(--unlocked-color); color: var(--unlocked-color); }
        .pt-node.purchased { border-color: var(--purchased-color); background-color: #d4edda; color: var(--purchased-color); font-weight: bold; }
        #pt-center { grid-column: 3; grid-row: 3; }
        #pt-b1-1 { grid-column: 3; grid-row: 2; } #pt-b1-2 { grid-column: 3; grid-row: 1; } #pt-b1-3 { grid-column: 4; grid-row: 1; } #pt-b1-4 { grid-column: 5; grid-row: 1; } #pt-b1-5 { grid-column: 5; grid-row: 2; }
        #pt-b2-1 { grid-column: 2; grid-row: 3; } #pt-b2-2 { grid-column: 1; grid-row: 3; } #pt-b2-3 { grid-column: 1; grid-row: 2; } #pt-b2-4 { grid-column: 1; grid-row: 1; } #pt-b2-5 { grid-column: 2; grid-row: 1; }
        #pt-b3-1 { grid-column: 4; grid-row: 3; } #pt-b3-2 { grid-column: 5; grid-row: 3; } #pt-b3-3 { grid-column: 5; grid-row: 4; } #pt-b3-4 { grid-column: 5; grid-row: 5; } #pt-b3-5 { grid-column: 4; grid-row: 5; }
        #pt-b4-1 { grid-column: 3; grid-row: 4; } #pt-b4-2 { grid-column: 3; grid-row: 5; } #pt-b4-3 { grid-column: 2; grid-row: 5; } #pt-b4-4 { grid-column: 1; grid-row: 5; } #pt-b4-5 { grid-column: 1; grid-row: 4; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        #controls { margin-top: 10px; }
    </style>
</head>
<body>
    <div id="game-container">
        <button id="cookie-btn" oncontextmenu="return false;"></button>
        <h3><span class="lang" data-key="cookies">Ciasteczka</span>: <span id="score">0</span></h3>
        <p style="margin: 5px 0 0;"><span class="lang" data-key="cpc">Klik</span>: <span id="cpc-display">1</span> <small id="crit-info"></small></p>

        <button id="upgrade1-btn" class="upgrade-btn"></button>
        <div class="new-upgrades-container">
            <button id="upgrade2-btn" class="upgrade-btn"></button>
            <button id="upgrade3-btn" class="upgrade-btn"></button>
            <hr>
            <h4 class="lang" data-key="permanent_upgrades">Trwałe Ulepszenia</h4>
            <button id="prestige-autoclicker-btn" class="upgrade-btn"></button>
            <button id="prestige-crit-chance-btn" class="upgrade-btn"></button>
            <button id="prestige-crit-damage-btn" class="upgrade-btn"></button>
        </div>
        
        <hr>
        <div id="prestige-section" style="display: none;">
            <h4 class="lang" data-key="prestige">Prestiż</h4>
            <p><span class="lang" data-key="points">Punkty</span>: <span id="prestige-points">0</span></p>
            <button id="prestige-btn"></button>

            <div id="prestige-tree" style="display: none; margin-top: 15px;">
                <button id="pt-center" class="pt-node" data-id="center" data-title-key="pt_center_title"></button>
                <button id="pt-b1-1" class="pt-node" data-id="b1_1" data-title-key="pt_b1_1_title"></button>
                <button id="pt-b1-2" class="pt-node" data-id="b1_2" data-title-key="pt_b1_2_title"></button>
                <button id="pt-b1-3" class="pt-node" data-id="b1_3" data-title-key="pt_b1_3_title"></button>
                <button id="pt-b1-4" class="pt-node" data-id="b1_4" data-title-key="pt_b1_4_title"></button>
                <button id="pt-b1-5" class="pt-node" data-id="b1_5" data-title-key="pt_b1_5_title"></button>
                <button id="pt-b2-1" class="pt-node" data-id="b2_1" data-title-key="pt_b2_1_title"></button>
                <button id="pt-b2-2" class="pt-node" data-id="b2_2" data-title-key="pt_b2_2_title"></button>
                <button id="pt-b2-3" class="pt-node" data-id="b2_3" data-title-key="pt_b2_3_title"></button>
                <button id="pt-b2-4" class="pt-node" data-id="b2_4" data-title-key="pt_b2_4_title"></button>
                <button id="pt-b2-5" class="pt-node" data-id="b2_5" data-title-key="pt_b2_5_title"></button>
                <button id="pt-b3-1" class="pt-node" data-id="b3_1" data-title-key="pt_b3_1_title"></button>
                <button id="pt-b3-2" class="pt-node" data-id="b3_2" data-title-key="pt_b3_2_title"></button>
                <button id="pt-b3-3" class="pt-node" data-id="b3_3" data-title-key="pt_b3_3_title"></button>
                <button id="pt-b3-4" class="pt-node" data-id="b3_4" data-title-key="pt_b3_4_title"></button>
                <button id="pt-b3-5" class="pt-node" data-id="b3_5" data-title-key="pt_b3_5_title"></button>
                <button id="pt-b4-1" class="pt-node" data-id="b4_1" data-title-key="pt_b4_1_title"></button>
                <button id="pt-b4-2" class="pt-node" data-id="b4_2" data-title-key="pt_b4_2_title"></button>
                <button id="pt-b4-3" class="pt-node" data-id="b4_3" data-title-key="pt_b4_3_title"></button>
                <button id="pt-b4-4" class="pt-node" data-id="b4_4" data-title-key="pt_b4_4_title"></button>
                <button id="pt-b4-5" class="pt-node" data-id="b4_5" data-title-key="pt_b4_5_title"></button>
            </div>
        </div>
        <hr>
        
        <div id="controls">
            <input id="nickname-input" placeholder="Wpisz swój nick">
            <button id="set-nickname-btn" class="lang" data-key="set_nickname_btn">Ustaw</button>
            <button id="reset-btn" class="lang" data-key="reset_btn">Resetuj</button>
            <button id="lang-switcher">Switch to English</button>
        </div>
        
        <h4 class="lang" data-key="leaderboard">Ranking Top 10</h4>
        <div id="leaderboard"> <ol id="leaderboard-list"></ol> </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
    window.addEventListener('DOMContentLoaded', () => {

        const firebaseConfig = {
            apiKey: "TWOJ_API_KEY",
            authDomain: "TWOJ_AUTH_DOMAIN",
            databaseURL: "TWOJA_DATABASE_URL",
            projectId: "TWOJ_PROJECT_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const GAME_SETTINGS = {
            PRESTIGE_BASE_COST: 1000000,
            PRESTIGE_COST_INCREASE_RATE: 1.07,
            UPGRADE1_CAP: 1000,
            UPGRADE1_MIN_MULTIPLIER_EFFECT: 0.005
        };
        
        const translations = {
            pl: {
                cookies: "Ciasteczka", cpc: "Klik", crit_chance: "szans na krytyk",
                upgrade1_btn: "Ulepszenie 1 (Poziom: {0})", cost: "Koszt", upgrade_max_level: "Maksymalny Poziom",
                upgrade2_btn: "Ulepszenie 2 (Poziom: {0})", upgrade3_btn: "Ulepszenie 3 (Poziom: {0})",
                permanent_upgrades: "Trwałe Ulepszenia", autoclicker_btn: "Trwały Auto-Clicker ({0} klik/s)",
                crit_chance_btn: "+0.1% szansy na krytyk (Poziom: {0})", crit_damage_btn: "+2% bonusu krytyka (Poziom: {0})",
                prestige: "Prestiż", points: "Punkty", prestige_btn: "Prestiż",
                set_nickname_btn: "Ustaw", reset_btn: "Resetuj", switch_language_btn: "Switch to English", leaderboard: "Ranking Top 10",
                pt_center_title: "Lepsze skalowanie ulepszeń",
                pt_b1_1_title: "Odblokuj Ulepszenie 2", pt_b1_2_title: "Ulepszenie 2 daje 1.5% bonusu",
                pt_b1_3_title: "Odblokuj Ulepszenie 3", pt_b1_4_title: "Ulepszenie 3 jest lepsze", pt_b1_5_title: "Nieskończone ulepszenie gałęzi 1",
                pt_b2_1_title: "Bonus co 100 ulepszeń", pt_b2_2_title: "Spadek wzrostu ceny", pt_b2_3_title: "Spadek wzrostu ceny", pt_b2_4_title: "Spadek wzrostu ceny", pt_b2_5_title: "Nieskończony spadek wzrostu ceny",
                pt_b3_1_title: "Odblokuj trwały Auto-Clicker", pt_b3_2_title: "Auto-Clicker +15% szybciej", pt_b3_3_title: "Auto-Clicker +25% szybciej", pt_b3_4_title: "Auto-Clicker wpływa na krytyki", pt_b3_5_title: "Nieskończona szybkość Auto-Clickera",
                pt_b4_1_title: "Odblokuj Trafienia Krytyczne", pt_b4_2_title: "Odblokuj trwałe ulepszenie szansy na krytyk", pt_b4_3_title: "Odblokuj trwałe ulepszenie bonusu krytyka", pt_b4_4_title: "Bonus do szansy i obrażeń krytycznych", pt_b4_5_title: "Nieskończone ulepszenie krytyków",
                node_cost: "Koszt", node_level: "Poziom"
            },
            en: {
                cookies: "Cookies", cpc: "Click", crit_chance: "crit chance",
                upgrade1_btn: "Upgrade 1 (Level: {0})", cost: "Cost", upgrade_max_level: "Max Level",
                upgrade2_btn: "Upgrade 2 (Level: {0})", upgrade3_btn: "Upgrade 3 (Level: {0})",
                permanent_upgrades: "Permanent Upgrades", autoclicker_btn: "Permanent Auto-Clicker ({0} clicks/s)",
                crit_chance_btn: "+0.1% crit chance (Level: {0})", crit_damage_btn: "+2% crit bonus (Level: {0})",
                prestige: "Prestige", points: "Points", prestige_btn: "Prestige",
                set_nickname_btn: "Set", reset_btn: "Reset", switch_language_btn: "Zmień na polski", leaderboard: "Top 10 Leaderboard",
                pt_center_title: "Better upgrade scaling",
                pt_b1_1_title: "Unlock Upgrade 2", pt_b1_2_title: "Upgrade 2 gives 1.5% bonus",
                pt_b1_3_title: "Unlock Upgrade 3", pt_b1_4_title: "Upgrade 3 is better", pt_b1_5_title: "Infinite Branch 1 upgrade",
                pt_b2_1_title: "Bonus every 100 upgrades", pt_b2_2_title: "Cost growth reduction", pt_b2_3_title: "Cost growth reduction", pt_b2_4_title: "Cost growth reduction", pt_b2_5_title: "Infinite cost growth reduction",
                pt_b3_1_title: "Unlock permanent Auto-Clicker", pt_b3_2_title: "Auto-Clicker +15% faster", pt_b3_3_title: "Auto-Clicker +25% faster", pt_b3_4_title: "Auto-Clicker affects crits", pt_b3_5_title: "Infinite Auto-Clicker speed",
                pt_b4_1_title: "Unlock Critical Hits", pt_b4_2_title: "Unlock permanent crit chance upgrade", pt_b4_3_title: "Unlock permanent crit bonus upgrade", pt_b4_4_title: "Bonus to crit chance and damage", pt_b4_5_title: "Infinite crit upgrade",
                node_cost: "Cost", node_level: "Level"
            }
        };

        let gameState = {};
        const defaultState = {
            cookies: 0,
            upgrade1Level: 0, upgrade1Cost: 10,
            upgrade2Level: 0, upgrade2Cost: 1,
            upgrade3Level: 0, upgrade3Cost: 5000,
            prestigePoints: 0,
            prestigeUpgrades: {},
            prestigeAutoclickerLevel: 0,
            prestigeCritChanceLevel: 0,
            prestigeCritDamageLevel: 0,
            nickname: "Anonim",
            language: 'pl'
        };
        
        const D = document;
        let autoclickerInterval = null;

        const prestigeTree = {
            'center': { cost: 1, unlocks: ['b1_1', 'b2_1', 'b3_1', 'b4_1'] },
            'b1_1': { cost: 1, unlocks: ['b1_2'] }, 'b1_2': { cost: 2, unlocks: ['b1_3'] }, 'b1_3': { cost: 3, unlocks: ['b1_4'] }, 'b1_4': { cost: 7, unlocks: ['b1_5'] }, 'b1_5': { cost: 5, costIncrease: 3, infinite: true },
            'b2_1': { cost: 3, unlocks: ['b2_2'] }, 'b2_2': { cost: 4, unlocks: ['b2_3'] }, 'b2_3': { cost: 6, unlocks: ['b2_4'] }, 'b2_4': { cost: 8, unlocks: ['b2_5'] }, 'b2_5': { cost: 5, costIncrease: 3, infinite: true },
            'b3_1': { cost: 1, unlocks: ['b3_2'] }, 'b3_2': { cost: 2, unlocks: ['b3_3'] }, 'b3_3': { cost: 4, unlocks: ['b3_4'] }, 'b3_4': { cost: 6, unlocks: ['b3_5'] }, 'b3_5': { cost: 5, costIncrease: 3, infinite: true },
            'b4_1': { cost: 1, unlocks: ['b4_2'] }, 'b4_2': { cost: 2, unlocks: ['b4_3'] }, 'b4_3': { cost: 4, unlocks: ['b4_4'] }, 'b4_4': { cost: 8, unlocks: ['b4_5'] }, 'b4_5': { cost: 5, costIncrease: 3, infinite: true },
        };

        const t = (key, ...args) => {
            let string = translations[gameState.language][key] || key;
            args.forEach((arg, i) => { string = string.replace(`{${i}}`, arg); });
            return string;
        };
        const formatNumber = (num) => { /* ... (bez zmian) ... */ };
        const getPU = (key) => gameState.prestigeUpgrades[key] || 0;
        const sumArithmeticSeries = (n, a, d) => { /* ... (bez zmian) ... */ };
        const calculateTotalPrestigesSpent = () => { /* ... (bez zmian) ... */ };
        const calculatePrestigeCost = () => { /* ... (bez zmian) ... */ };
        const calculateTotalCPC = (isCrit = false) => { /* ... (bez zmian) ... */ };
        const handleCookieClick = (isAuto = false) => { /* ... (bez zmian) ... */ };

        const updateUI = () => {
            document.querySelectorAll('.lang').forEach(el => {
                el.textContent = t(el.dataset.key);
            });
            D.getElementById('score').textContent = formatNumber(gameState.cookies);
            D.getElementById('cpc-display').textContent = formatNumber(calculateTotalCPC());
            if (getPU('b4_1')) {
                let critChance = 0.01 + (getPU('b4_4') ? 0.02 : 0) + (gameState.prestigeCritChanceLevel * 0.001) + ((getPU('b4_5_level') || 0) * 0.001);
                D.getElementById('crit-info').textContent = `(${(critChance * 100).toFixed(1)}% ${t('crit_chance')})`;
            } else { D.getElementById('crit-info').textContent = ''; }
            
            const upg1Btn = D.getElementById('upgrade1-btn');
            if (gameState.upgrade1Level >= GAME_SETTINGS.UPGRADE1_CAP) {
                upg1Btn.textContent = t('upgrade_max_level');
                upg1Btn.disabled = true;
            } else {
                upg1Btn.textContent = `${t('upgrade1_btn', formatNumber(gameState.upgrade1Level))} | ${t('cost')}: ${formatNumber(gameState.upgrade1Cost)}`;
                upg1Btn.disabled = false;
            }

            const upg2Btn = D.getElementById('upgrade2-btn'); upg2Btn.classList.toggle('visible', getPU('b1_1'));
            upg2Btn.textContent = `${t('upgrade2_btn', formatNumber(gameState.upgrade2Level))} | ${t('cost')}: ${formatNumber(gameState.upgrade2Cost)}`;
            const upg3Btn = D.getElementById('upgrade3-btn'); upg3Btn.classList.toggle('visible', getPU('b1_3'));
            upg3Btn.textContent = `${t('upgrade3_btn', formatNumber(gameState.upgrade3Level))} | ${t('cost')}: ${formatNumber(gameState.upgrade3Cost)}`;

            const pacBtn = D.getElementById('prestige-autoclicker-btn'); pacBtn.classList.toggle('visible', getPU('b3_1'));
            let pacCost = 1 + (gameState.prestigeAutoclickerLevel * 2);
            pacBtn.textContent = `${t('autoclicker_btn', gameState.prestigeAutoclickerLevel)} | ${t('cost')}: ${formatNumber(pacCost)} PP`;
            
            const pccBtn = D.getElementById('prestige-crit-chance-btn'); pccBtn.classList.toggle('visible', getPU('b4_2'));
            let pccCost = 1 + (gameState.prestigeCritChanceLevel * 2);
            pccBtn.textContent = `${t('crit_chance_btn', gameState.prestigeCritChanceLevel)} | ${t('cost')}: ${formatNumber(pccCost)} PP`;

            const pcdBtn = D.getElementById('prestige-crit-damage-btn'); pcdBtn.classList.toggle('visible', getPU('b4_3'));
            let pcdCost = 1 + (gameState.prestigeCritDamageLevel * 2);
            pcdBtn.textContent = `${t('crit_damage_btn', gameState.prestigeCritDamageLevel)} | ${t('cost')}: ${formatNumber(pcdCost)} PP`;
            
            const hasPrestiged = Object.keys(gameState.prestigeUpgrades).length > 0 || gameState.prestigePoints > 0;
            const currentPrestigeCost = calculatePrestigeCost();
            D.getElementById('prestige-section').style.display = gameState.cookies >= currentPrestigeCost || hasPrestiged ? 'block' : 'none';
            D.getElementById('prestige-points').textContent = formatNumber(gameState.prestigePoints);
            D.getElementById('prestige-btn').textContent = `${t('prestige_btn')} (${t('cost')}: ${formatNumber(currentPrestigeCost)})`;
            D.getElementById('prestige-tree').style.display = hasPrestiged ? 'grid' : 'none';
            D.getElementById('lang-switcher').textContent = t('switch_language_btn');
            
            document.querySelectorAll('.pt-node').forEach(btn => {
                const id = btn.dataset.id; const node = prestigeTree[id]; if (!node) return;
                let cost = node.cost; if (node.infinite) { cost += (getPU(id + '_level') || 0) * node.costIncrease; }
                btn.disabled = true; btn.classList.remove('unlocked', 'purchased');
                if(getPU(id) && !node.infinite) { btn.classList.add('purchased'); } else if (node.infinite) { btn.classList.remove('purchased'); }
                let canUnlock = id === 'center' || Object.keys(prestigeTree).some(p_id => prestigeTree[p_id].unlocks?.includes(id) && getPU(p_id));
                if (canUnlock && !(getPU(id) && !node.infinite)) {
                    btn.classList.add('unlocked');
                    if (gameState.prestigePoints >= cost) { btn.disabled = false; }
                }
                btn.innerHTML = `${btn.id.split('-').pop().toUpperCase()}<br><small>${t(btn.dataset.titleKey)}</small>`;
                let titleText = `${t(btn.dataset.titleKey)} (${t('cost')}: ${cost} PP)`;
                if (node.infinite) titleText += ` | ${t('node_level')}: ${getPU(id + '_level') || 0}`;
                btn.title = titleText;
            });
        };

        const saveGame = () => localStorage.setItem('clickerGameSave', JSON.stringify(gameState));
        
        const loadGame = () => {
            let savedData; 
            try { 
                savedData = JSON.parse(localStorage.getItem('clickerGameSave')); 
            } catch (e) { 
                savedData = null; 
            }
            
            gameState = { ...defaultState };
            
            if (savedData) {
                // Skopiuj zapisane wartości do czystego stanu, zamiast łączyć obiekty
                for (const key in defaultState) {
                    if (savedData[key] !== undefined) {
                        // Głębokie kopiowanie dla prestigeUpgrades, aby uniknąć problemów
                        if (key === 'prestigeUpgrades' && typeof savedData[key] === 'object') {
                            gameState[key] = { ...defaultState[key], ...savedData[key] };
                        } else {
                            gameState[key] = savedData[key];
                        }
                    }
                }
            }

            D.getElementById('nickname-input').value = gameState.nickname;
            setupAutoclicker();
            updateUI();
        };

        const setupAutoclicker = () => { /* ... (bez zmian) ... */ };
        
        D.getElementById('game-container').addEventListener('click', (event) => {
            const target = event.target.closest('button');
            if (!target) return;
            if (target.classList.contains('pt-node')) { /* ... (logika drzewka) ... */ return; }
            switch (target.id) { /* ... (reszta logiki przycisków) ... */ }
        });
        
        const updateLeaderboard = () => { /* ... (bez zmian) ... */ };
        database.ref('leaderboard').orderByChild('c').limitToLast(10).on('value', snapshot => { /* ... (bez zmian) ... */ });

        loadGame();
        setInterval(saveGame, 5000);
        setInterval(updateLeaderboard, 30000);
    });
    </script>
</body>
</html>
