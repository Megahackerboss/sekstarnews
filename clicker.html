<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Cookie Clicker</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; margin: 0; padding: 15px; background-color: #f7f7f7; color: #333; }
        #cookie-btn { background: url(https://i.ibb.co/RKxrz7P/proxy-image.png) center/cover; width: 150px; height: 150px; border: none; cursor: pointer; border-radius: 50%; transition: transform 0.1s; display: block; margin: 10px auto; }
        #cookie-btn:active { transform: scale(0.95); }
        button { cursor: pointer; padding: 10px 15px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; background-color: #e9e9e9; margin: 5px; }
        button:hover { background-color: #ddd; }
        #upgrade-btn { width: 95%; text-align: center; font-weight: bold; }
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
        #leaderboard ol { text-align: left; padding-left: 30px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>

    <button id="cookie-btn"></button>
    <h3>Ciasteczka: <span id="score">0</span></h3>
    <p style="margin: 5px 0 10px;">Łącznie za klik: <span id="cpc-display">1</span></p>

    <button id="upgrade-btn">Ulepsz</button>
    <hr>
    <div id="prestige-section" style="display: none;">
        <h4>Prestiż</h4>
        <p>Punkty: <span id="prestige-points">0</span></p>
        <button id="prestige-btn">Prestiż</button><br>
        <button id="prestige-upgrade-1" style="margin-top: 5px;">+1 do bazy/klik (Koszt: 1 PP)</button>
        <span>Poziom: <span id="prestige-upgrade-1-level">0</span></span>
    </div>
    <hr>
    
    <input id="nickname-input" placeholder="Wpisz swój nick">
    <button id="set-nickname-btn">Ustaw</button>
    <button id="reset-btn">Resetuj</button>
    
    <h4>Ranking Top 10</h4>
    <div id="leaderboard">
        <ol id="leaderboard-list"></ol>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        // === KONFIGURACJA FIREBASE ===
        // WAŻNE: Wklej tutaj swoją konfigurację!
        const firebaseConfig = {
            apiKey: "TWOJ_API_KEY",
            authDomain: "TWOJ_AUTH_DOMAIN",
            databaseURL: "TWOJA_DATABASE_URL",
            projectId: "TWOJ_PROJECT_ID",
            storageBucket: "TWOJ_STORAGE_BUCKET",
            messagingSenderId: "TWOJ_MESSAGING_SENDER_ID",
            appId: "TWOJ_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // === ZMIENNE GRY ===
        let gameState = {
            cookies: 0,
            upgradeLevel: 0,
            upgradeCost: 10,
            prestigePoints: 0,
            prestigeCost: 1000000,
            prestigeUpgradeLevel1: 0,
            nickname: "Anonim"
        };
        
        const D = document;
        const f = n => Math.floor(n).toLocaleString('pl-PL');

        // === FUNKCJE GRY ===
        const calculateBonus = (level) => {
            let bonus = 0;
            for (let i = 0; i < level; i++) {
                bonus += 1 + Math.floor(i / 10);
            }
            return bonus;
        };

        const calculateCPC = () => 1 + gameState.prestigeUpgradeLevel1 + calculateBonus(gameState.upgradeLevel);

        const updateUI = () => {
            D.getElementById('score').textContent = f(gameState.cookies);
            D.getElementById('cpc-display').textContent = f(calculateCPC());
            
            const nextUpgradeBonus = 1 + Math.floor(gameState.upgradeLevel / 10);
            const nextTotalCPC = 1 + gameState.prestigeUpgradeLevel1 + calculateBonus(gameState.upgradeLevel + 1);
            D.getElementById('upgrade-btn').textContent = `Ulepsz (+${f(nextUpgradeBonus)}) Koszt: ${f(gameState.upgradeCost)} | Razem: ${f(nextTotalCPC)}/klik`;
            
            D.getElementById('prestige-section').style.display = gameState.cookies >= gameState.prestigeCost || gameState.prestigePoints > 0 ? 'block' : 'none';
            D.getElementById('prestige-btn').textContent = `Prestiż (Koszt: ${f(gameState.prestigeCost)})`;
            D.getElementById('prestige-points').textContent = gameState.prestigePoints;
            D.getElementById('prestige-upgrade-1-level').textContent = gameState.prestigeUpgradeLevel1;
            D.getElementById('prestige-upgrade-1').textContent = `+1 do bazy/klik (Koszt: ${gameState.prestigeUpgradeLevel1 + 1} PP)`;
        };

        const saveGame = () => {
            localStorage.setItem('clickerGameSave', JSON.stringify(gameState));
            if (gameState.nickname && gameState.nickname !== 'Anonim') {
                const safeNickname = gameState.nickname.replace(/[.#$\[\]]/g, '_');
                database.ref('leaderboard/' + safeNickname).set({
                    nn: gameState.nickname,
                    c: Math.floor(gameState.cookies)
                });
            }
        };

        const loadGame = () => {
            const savedData = JSON.parse(localStorage.getItem('clickerGameSave'));
            if (savedData) {
                Object.assign(gameState, savedData);
            }
            D.getElementById('nickname-input').value = gameState.nickname;
            updateUI();
        };

        // === OBSŁUGA ZDARZEŃ ===
        D.getElementById('cookie-btn').onclick = () => {
            gameState.cookies += calculateCPC();
            updateUI();
        };

        D.getElementById('upgrade-btn').onclick = () => {
            if (gameState.cookies >= gameState.upgradeCost) {
                gameState.cookies -= gameState.upgradeCost;
                gameState.upgradeLevel++;
                gameState.upgradeCost *= 1.18;
                updateUI();
            }
        };
        
        D.getElementById('prestige-btn').onclick = () => {
            if (gameState.cookies >= gameState.prestigeCost) {
                gameState.prestigePoints++;
                gameState.cookies = 0;
                gameState.upgradeLevel = 0;
                gameState.upgradeCost = 10;
                gameState.prestigeCost *= 1.15;
                updateUI();
            }
        };
        
        D.getElementById('prestige-upgrade-1').onclick = () => {
            const cost = gameState.prestigeUpgradeLevel1 + 1;
            if (gameState.prestigePoints >= cost) {
                gameState.prestigePoints -= cost;
                gameState.prestigeUpgradeLevel1++;
                updateUI();
            }
        };
        
        D.getElementById('set-nickname-btn').onclick = () => {
            const nick = D.getElementById('nickname-input').value.trim();
            if (nick) gameState.nickname = nick;
            saveGame();
        };

        D.getElementById('reset-btn').onclick = () => {
            if (confirm('Czy na pewno chcesz zresetować cały postęp?')) {
                localStorage.removeItem('clickerGameSave');
                window.location.reload();
            }
        };

        // === FIREBASE LEADERBOARD ===
        database.ref('leaderboard').orderByChild('c').limitToLast(10).on('value', snapshot => {
            const list = D.getElementById('leaderboard-list');
            list.innerHTML = '';
            const scores = [];
            snapshot.forEach(child => { scores.push(child.val()) });
            scores.reverse().forEach(player => {
                const li = D.createElement('li');
                li.textContent = `${player.nn}: ${f(player.c)}`;
                list.appendChild(li);
            });
        });

        // === START GRY ===
        loadGame();
        setInterval(saveGame, 5000);
    </script>
</body>
</html>
